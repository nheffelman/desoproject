#:kivy 2.1.0
#:import CircularAvatarImage main.CircularAvatarImage
#:import StoryCreator main.StoryCreator
#:import PostCard main.PostCard
#:import kivymd kivymd



ScreenManager:
    id: screen
    LoginScreen:
    SignupScreen:
    UserNameLoginScreen:
    HomePageReadOnlyScreen:
    	
<SignupScreen>:
    name: 'signup'
    BoxLayout:
        orientation: 'vertical'
        padding: '10dp'
        spacing: '10dp'
        Image:
            source: 'assets/dragon.png'
            size_hint: (1, 1)
        Label:
            text: 'Sign up to check out the newest iteration of Deso.'
            font_size: '20sp'
            text_size: self.size
            halign: 'center'
        MDTextField:
            hint_text: 'Email'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
        MDTextField:
            hint_text: 'Full Name'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
        MDTextField:
            hint_text: 'Username'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
        MDTextField:
            hint_text: 'Password'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
            password: True
        Button:
            text: 'Sign up'
            size_hint: (0.8, None)
            height: '40dp'
            pos_hint: {'center_x': 0.5}
        Label:
            text: 'By signing up, you agree to our Terms & Privacy Policy.'
            font_size: '10sp'
            text_size: self.size
            halign: 'center'
        MDRoundFlatButton:
        	on_press: root.manager.current = 'login'
        	pos_hint: {'center_x': 0.5}
            text: 'Have an account? Log in'
        	font_size: '15sp'
       	 text_size: self.size
    	    halign: 'center'
            color: (0, 0, 1, 1)
        	underline: True
            
<LoginScreen>:
    name: 'login'
    BoxLayout:
        orientation: 'vertical'
        padding: '10dp'
        spacing: '10dp'
        Image:
            source: 'assets/dragon.png'
            size_hint: (1, 1)
        Label:
            text: 'Login to Desoliscious'
            font_size: '20sp'
            text_size: self.size
            halign: 'center'
        Label:
            text: 'Read-only Mode'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
        MDRoundFlatButton:
            on_press: root.manager.current = 'username'
            text: 'Login with Username'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
        Label:
            text: 'Full Access Mode'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
        MDRoundFlatButton:
            text: 'Login with Seed Phrase'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
        Label:
            text: 'Full Access Mode'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
        MDRoundFlatButton:
            text: 'Login with Desoliscious Identity'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
        
        Label:
            text: "Don't have a Deso Account, Sign Up"
            font_size: '15sp'
            text_size: self.size
            halign: 'center'
            color: (0, 0, 1, 1)
            underline: True
        MDRoundFlatButton:
            text: 'Sign Up'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
            on_press: root.manager.current = 'signup'

<UserNameLoginScreen>:
    name: 'username'
    BoxLayout:
        orientation: 'vertical'
        padding: '10dp'
        spacing: '10dp'
        Image:
            source: 'assets/dragon.png'
            size_hint: (1, 1)
        Label:
            text: 'Login with Username'
            font_size: '20sp'
            text_size: self.size
            halign: 'center'
        MDTextField:
            id: username
            hint_text: 'Username'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
            on_text_validate: root.textInput(self)
        MDRoundFlatButton:
            text: 'Login'
            pos_hint: {'center_x': 0.5}
            size_hint: (0.8, None)
            height: '40dp'
            on_press: root.onClick()

<HomePageReadOnlyScreen>:
    name: 'homepage_read_only'
    orientation: 'vertical'
    MDBoxLayout:
        orientation: 'vertical'
        # App Bar
        MDBoxLayout:
            adaptive_height: True

            MDIconButton:
                icon: 'plus'

            MDLabel:
                id: username
                text: 'Desoliscious'
                halign: 'center'
                valign: 'top'
                font_size: 50
                font_name: 'assets/Instafont.otf'

            MDLabel:
                id: desoprice
                text: root.desoprice
        MDBoxLayout:
            ScrollView:
                bar_width: 0

                MDBoxLayout:
                    adaptive_height: True

                    MDBoxLayout:
                        orientation: 'vertical'
                        adaptive_height: True
                        id: timeline

                        # Stories
                        ScrollView:
                            size_hint_y: None
                            height: 110
                            bar_width: 0

                            MDBoxLayout:
                                adaptive_width: True
                                spacing: 5
                                padding: 5

                                # Story Creator
                                StoryCreator:
                                    size_hint: None, None
                                    size: 62, 100
                                    padding: 5
                                    spacing: 5

                                    MDRelativeLayout:
                                        size_hint: None, None
                                        size: 60, 100

                                        Circle:
                                            radius: [50, ]
                                            size: 60, 60
                                            md_bg_color: 1,1,1,1

                                        Circle:
                                            radius: [50, ]
                                            size: 55, 55
                                            md_bg_color: 1,1,1,1

                                        FitImage:
                                            source: root.profile_picture
                                            size_hint: None, None
                                            size: 53,53
                                            radius: [53]
                                            pos_hint: {"center_x":0.5, "center_y":0.6}

                                        Circle:
                                            size_hint: None, None
                                            size: 17, 17
                                            md_bg_color: 1,1,1,1
                                            radius: [17, ]
                                            pos_hint: {"center_x":0.8, "center_y":0.4}

                                        FitImage:
                                            size_hint: None, None
                                            source: 'assets/plus_icon.png'
                                            size: 15, 15
                                            md_bg_color: 0,0,1,1
                                            radius: [15, ]
                                            pos_hint: {"center_x":0.8, "center_y":0.4}

                                        MDLabel:
                                            text: "Your Story"
                                            halign: 'center'
                                            pos_hint: {"center_x":0.5, "center_y":0.2}
                                            font_size: 11
                                            theme_text_color: 'Custom'
                                            text_color: 0, 0, 0, 1

                                MDBoxLayout:
                                    adaptive_width: True
                                    padding: 5
                                    spacing: 5
                                    id: stories
                        MDSeparator:

        MDBoxLayout:
            adaptive_height: True
            spacing: 10
            padding: 10

            MDIconButton:
                icon: 'home'
            MDIconButton:
                icon: 'magnify'
            MDIconButton:
                icon: 'movie'
            MDIconButton:
                icon: 'heart-outline'
            FitImage:
                source: root.profile_picture
                size_hint: None, None
                size: 25, 25
                radius: [25, ]
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}


<Circle@MDCard>
    size_hint: None, None
    elevation: 0
    pos_hint: {"center_x": 0.5, "center_y": 0.6}

<CircularAvatarImage>
    size_hint: None, None
    size: 62, 100
    elevation: 0

    MDRelativeLayout:
        size_hint: None, None
        size: 60, 100

        Circle:
            radius: [50, ]
            size: 60, 60
            md_bg_color: 1,0,0,1

        Circle:
            radius: [50, ]
            size: 55, 55
            md_bg_color: 1,1,1,1

        # profile picture
        FitImage:
            id: avatar
            source: root.avatar
            size_hint: None, None
            size: 53, 53
            radius: [53]
            pos_hint: {"center_x":0.5, "center_y":0.6}

        # Username
        MDLabel:
            id: name
            text: root.name
            halign: 'center'
            pos_hint: {"center_x:": 0.5, "center_y": 0.2}
            font_size: 11
            theme_text_color: "Custom"
            text_color: 0,0,0,1

<PostCard>
    orientation: 'vertical'
    size_hint_y: None
    height: "420dp"
    spacing: 2
    elevation: 0

    MDBoxLayout:
        padding: 2
        adaptive_height: True

        OneLineAvatarListItem:
            text: f'[b][size=24]{root.username}[/size][/b]'
            divider: None
            _no_ripple_effect: True

            ImageLeftWidget:
                source: root.avatar
                radius: [20, ]
        MDIconButton:
            icon: 'dots-vertical'
    MDLabel:
    	adaptive_height: True
    	text: root.body[:144] + root.readmore

    # Post
    FitImage:
        adaptive_height: True
        source: root.post

    # Reactions
    MDBoxLayout:
        padding: 5, 0, 0, 0
        spacings: 2
        adaptive_height: True

        MDIconButton:
            icon: "heart-outline"
            
        MyLabel:
            valign: 'top'
            text: f'{root.likes}'
            bold: True

        MDIconButton:
            icon: 'message-outline'
            
		MyLabel:
			text: f'{root.comments}'
			
		MDIconButton:
			icon: 'repeat'

		MyLabel:
			text: f'{root.repost}'
			
        MDIconButton:
            icon: 'diamond-outline'
            
        MyLabel: 
			text: f'{root.diamonds}'
			bold: True

        Widget:

      
    MDBoxLayout:
        orientation: 'vertical'
        padding: 5,0,0,0
        spacing: 3
        adaptive_height: True

        MyLabel:
            markup: True
            text: f'[b]{root.username}[/b] {root.caption}'

        HalfOpacityLabel:
            text: f'View all {root.comments} comments'

    MDBoxLayout:
        padding: 5,0,0,0
        spacing: 2
        adaptive_height: True

        FitImage:
            source: root.profile_pic
            size_hint: None, None
            size: 20,20
            radius: [20, ]

        HalfOpacityLabel:
            text: 'Add a comment...'

    MDBoxLayout:
        padding: 9,0,0,0
        spacing: 0
        adaptive_height: True

        HalfOpacityLabel:
            font_size: 10
            text: f'{root.posted_ago} agp'



<MyLabel@MDLabel>
    adaptive_height:True
    font_size: 24

<HalfOpacityLabel@MyLabel>:
    theme_text_color: 'Custom'
    text_color: 0,0,0,0.5


        

    

        